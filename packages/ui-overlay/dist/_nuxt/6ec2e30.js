(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{1026:function(e,t,n){"use strict";n.r(t);var r=n(3),o=(n(44),n(36),n(66),n(24),n(22),n(49),n(59),n(20)),l=(n(78),n(11),n(43),n(38),n(472),n(308),n(70),n(112),n(96),n(77),n(27),n(170)),c=n(471),f=n(307);function d(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var v={};v.props={opts:{key:"opts",required:!0,type:Object}},v.setup=function(e,t){var n=e,h=Object(r.ref)(Object(f.defaults)(n.opts,{galleryCache:!1,galleryCacheLimitInMb:50})),v=!!new URL(location.href).searchParams.get("debug"),m=Object(r.ref)(!1),y=Object(r.ref)([]);Object(r.onMounted)((function(){console.log("====== MEDIA ======"),h.value.galleryCache?(console.log("Gallery cache enabled (".concat(h.value.galleryCacheLimitInMb,"Mb)")),Object(l.getSocket)("/overlays/media",!0).emit("cache",h.value.galleryCacheLimitInMb,function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(t,data){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",console.error(t));case 2:n=d(data),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=12;break}return o=r.value,e.next=9,fetch(new Request("/gallery/"+o,{cache:"default"}));case 9:console.log("/gallery/"+o+" loaded.");case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[3,14,17,20]])})));return function(t,n){return e.apply(this,arguments)}}())):console.log("Gallery cache disabled."),Object(l.getSocket)("/overlays/media",!0).on("alert",(function(data){var e,t=d(data);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.run=!1,n.isLoaded=!1,n.finished=!1,n.leaveAnimation=!1,n.receivedAt=Date.now()}}catch(e){t.e(e)}finally{t.f()}y.value.push(data)})),setInterval((function(){try{if(m.value){var e,t=d(w.value);try{var n=function(){var a=e.value;if(a.run)return"continue";if(a.delay=Number(a.delay),isNaN(a.delay)&&(a.delay=0),!(a.receivedAt+a.delay<Date.now()))return"continue";if(a.run=!0,"audio"===a.type){if(!a.url)return a.finished=!0,"continue";var audio=[document.getElementById("audio")];if(audio.length>0){var t,n=d(audio);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.src===a.url&&(a.volume&&(r.volume=Number(a.volume)/100),r.error?(a.finished=!0,console.error("Something went wrong with your audio file")):(r.onended=function(){return a.finished=!0},console.log("playing"),r.play().catch((function(e){e&&(console.error("Something went wrong with your audio file"),console.error(e.message),(a.url.startsWith("https://")&&window.location.protocol.startsWith("http:")||a.url.startsWith("http://")&&window.location.protocol.startsWith("https:"))&&console.error("You are using mixed content https + http"),a.finished=!0)}))))}}catch(e){n.e(e)}finally{n.f()}}else a.run=!1}if("video"===a.type||"clip"===a.type){if(!a.url)return a.finished=!0,"continue";var video=[document.getElementById("video")];if(video.length>0){var o,l=d(video);try{var c=function(){var e=o.value;e.dataset.src===a.url&&(void 0===a.size&&(a.size="100%"),e.error?(a.leaveAnimation=!0,a.finished=!0,console.error("Something went wrong with your video file"),console.error(e.error)):(e.onended=function(){a.leaveAnimation=!0,setTimeout((function(){return a.finished=!0}),Number(a.duration||1e3))},setTimeout((function(){a.canBePlayed||a.thumbnail||(a.thumbnail=!0,e.volume=0,e.play().catch((function(e){e&&(console.error("Something went wrong with your video file"),console.error(e.message),(a.url.startsWith("https://")&&window.location.protocol.startsWith("http:")||a.url.startsWith("http://")&&window.location.protocol.startsWith("https:"))&&console.error("You are using mixed content https + http"),a.finished=!0)})),setTimeout((function(){e.pause(),setTimeout((function(){a.volume&&(e.volume=Number(a.volume)/100),a.isLoaded=!0,e.play().catch((function(e){e&&(console.error("Something went wrong with your video file"),console.error(e.message),(a.url.startsWith("https://")&&window.location.protocol.startsWith("http:")||a.url.startsWith("http://")&&window.location.protocol.startsWith("https:"))&&console.error("You are using mixed content https + http"),a.finished=!0)}))}),1e3)}),100))}),5e3),e.oncanplaythrough=function(){a.canBePlayed=!0,a.thumbnail||(a.thumbnail=!0,e.volume=0,e.play().catch((function(e){e&&(console.error("Something went wrong with your video file"),console.error(e.message),(a.url.startsWith("https://")&&window.location.protocol.startsWith("http:")||a.url.startsWith("http://")&&window.location.protocol.startsWith("https:"))&&console.error("You are using mixed content https + http"),a.finished=!0)})).then((function(){setTimeout((function(){e.pause(),setTimeout((function(){a.volume&&(e.volume=Number(a.volume)/100),a.isLoaded=!0,e.play(),console.log("Playing video "+e.dataset.src)}),1e3)}),150)})))}))};for(l.s();!(o=l.n()).done;)c()}catch(e){l.e(e)}finally{l.f()}}else a.run=!1}a.finished||["audio","video","clip"].includes(a.type)||(setTimeout((function(){return a.leaveAnimation=!0}),Number(a.duration||1e3)+Number(a.time||1e3)),setTimeout((function(){return a.finished=!0}),Number(a.duration||1e3)+Number(a.duration||1e3)+Number(a.time||1e3)))};for(t.s();!(e=t.n()).done;)n()}catch(e){t.e(e)}finally{t.f()}}else m.value=null!==w.value}catch(e){console.error(e)}}),100)}));var w=Object(r.computed)((function(){return y.value.length>0?y.value[0]:null})),x=Object(r.computed)((function(){return w.value?w.value.filter((function(e){return e.finished})).length:0})),A=Object(r.computed)((function(){return!w.value||x.value===w.value.length}));Object(r.watch)(A,(function(e){if(e&&(m.value=!1,y.value.shift(),y.value[0])){var t,n=d(y.value[0]);try{for(n.s();!(t=n.n()).done;){t.value.receivedAt=Date.now()}}catch(e){n.e(e)}finally{n.f()}}}));return{isDebug:v,isPlaying:m,getCurrentAlertList:w,finishedCount:x,isFinished:A,doEnterAnimation:function(e,t){c.default.to(e,{duration:(w.value[e.dataset.index||0].duration||1e3)/1e3,opacity:1,onComplete:function(){t()}})},doLeaveAnimation:function(e,t){c.default.to(e,{duration:(w.value[e.dataset.index||0].duration||1e3)/1e3,opacity:0,onComplete:function(){t()}})}}};var m=v,y=(n(800),n(95)),component=Object(y.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.isDebug?n("pre",{staticClass:"debug"},[e._v("isFinished: "+e._s(e.isFinished)+"\nisPlaying: "+e._s(e.isPlaying)+"\ncurrent: "+e._s(e.getCurrentAlertList)+"\nfinishedCount: "+e._s(e.finishedCount)+"\nfinished: "+e._s((e.getCurrentAlertList||[]).filter((function(e){return e.finished})))+"\n      ")]):e._e(),e._v(" "),e.isPlaying&&!e.isFinished?n("div",{staticClass:"absolute"},e._l(e.getCurrentAlertList,(function(t,r){return n("transition",{key:r,attrs:{css:!1},on:{enter:e.doEnterAnimation,leave:e.doLeaveAnimation}},["html"===t.type&&t.run?n("iframe",{directives:[{name:"show",rawName:"v-show",value:t.run&&!t.finished&&!t.leaveAnimation,expression:"alert.run && !alert.finished && !alert.leaveAnimation"}],class:[t.class?t.class:""],attrs:{"data-index":r,src:t.url}}):e._e(),e._v(" "),"audio"===t.type?n("audio",{attrs:{id:"audio",src:t.url}}):e._e(),e._v(" "),"video"===t.type||"clip"===t.type?n("video",{directives:[{name:"show",rawName:"v-show",value:t.run&&t.isLoaded&&!t.finished&&!t.leaveAnimation,expression:"alert.run && alert.isLoaded && !alert.finished && !alert.leaveAnimation"}],class:[t.class?t.class:""],style:{width:t.size,top:t["y-offset"]?t["y-offset"]+"px":"inherit",left:t["x-offset"]?t["x-offset"]+"px":"inherit"},attrs:{id:"video",preload:"metadata",playsinline:"","data-index":r,"data-src":t.url}},[n("source",{attrs:{src:t.url+"#t=0.1",type:"video/mp4"}})]):e._e(),e._v(" "),"text"===t.type?n("div",{directives:[{name:"show",rawName:"v-show",value:t.run&&!t.finished&&!t.leaveAnimation,expression:"alert.run && !alert.finished && !alert.leaveAnimation"}],staticClass:"text",class:[t.class?t.class:""],style:{top:t["y-offset"]?t["y-offset"]+"px":"inherit",left:t["x-offset"]?t["x-offset"]+"px":"inherit","text-align":t.align||"left"},attrs:{"data-index":r}},[e._v("\n          "+e._s(t.text)+"\n        ")]):e._e(),e._v(" "),"image"===t.type?n("img",{directives:[{name:"show",rawName:"v-show",value:t.run&&!t.finished&&!t.leaveAnimation,expression:"alert.run && !alert.finished && !alert.leaveAnimation"}],staticClass:"image",class:[t.class?t.class:""],style:{top:t["y-offset"]?t["y-offset"]+"px":"inherit",left:t["x-offset"]?t["x-offset"]+"px":"inherit"},attrs:{"data-index":r,src:t.url}}):e._e()])})),1):e._e()])}),[],!1,null,"05faf8a2",null);t.default=component.exports},647:function(e,t,n){var content=n(801);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(111).default)("40e1fd6a",content,!0,{sourceMap:!1})},800:function(e,t,n){"use strict";n(647)},801:function(e,t,n){var r=n(110)((function(i){return i[1]}));r.push([e.i,".debug[data-v-05faf8a2]{z-index:9999;background-color:rgba(0,0,0,.5);color:#fff;padding:1rem}.absolute[data-v-05faf8a2],.debug[data-v-05faf8a2]{position:absolute}.absolute[data-v-05faf8a2]{width:100%;height:100%;display:table}.text[data-v-05faf8a2],audio[data-v-05faf8a2],iframe[data-v-05faf8a2],img[data-v-05faf8a2],video[data-v-05faf8a2]{opacity:0;position:relative}video[data-v-05faf8a2]{background:transparent}iframe[data-v-05faf8a2],video[data-v-05faf8a2]{border:0;width:100%;height:100%}.fade-enter-active[data-v-05faf8a2],.fade-leave-active[data-v-05faf8a2]{transition:opacity 2s}.fade-enter[data-v-05faf8a2],.fade-leave-to[data-v-05faf8a2]{opacity:0}",""]),r.locals={},e.exports=r}}]);