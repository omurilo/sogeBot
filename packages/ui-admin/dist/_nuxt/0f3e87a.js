(window.webpackJsonp=window.webpackJsonp||[]).push([[159,97,112],{1453:function(e,t,n){"use strict";n.r(t);n(1),n(40),n(33),n(51),n(25),n(11),n(52),n(55),n(8),n(14),n(15);var r,o=n(2),c=n(35),l=n(26),v=(n(81),n(4),n(37),n(39),n(73),n(46),n(13),n(12),n(28),n(31),n(24),n(273),n(5)),d=n(771),f=n(118),m=n(21),y=n(49),h=n.n(y),O=n(54),_=n(173),j=n(777),w=n(80),x=n(141),k=n(265);function S(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function D(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?S(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):S(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return V(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var A=Object(v.c)({components:{"new-item":Object(v.b)({loader:function(){return n.e(45).then(n.bind(null,1549))}})},setup:function(){var e={title:[k.h],options:[Object(k.a)(2)]},t=Object(v.i)([]),n=Object(v.a)((function(){return void 0!==t.value.find((function(e){return"string"!=typeof e&&e.isOpened}))})),y=Object(v.i)(""),S=Object(v.i)([]),V=Object(v.i)([]),A=Object(v.i)(!1);Object(v.p)(A,(function(e){e||(S.value=[])}));var P=Object(v.i)(!1),I=Object(v.i)(!1),$=Object(v.i)(Date.now());Object(v.p)(I,(function(){$.value=Date.now()})),Object(v.f)((function(){r=window.setInterval((function(){E()}),1e3)})),Object(v.g)((function(){window.clearInterval(r)}));var T=Object(v.i)({loading:d.ButtonStates.progress}),B=[{value:"title",text:h()("systems.polls.title")},{value:"type",text:h()("systems.polls.votingBy")},{value:"votes",text:"",width:"20rem",sortable:!1},{value:"totalVotes",text:h()("systems.polls.totalVotes"),align:"align-center"},{value:"closedAt",text:""},{value:"buttons",text:"",sortable:!1}];Object(v.f)((function(){E()}));var E=function(){Object(m.getSocket)("/systems/polls").emit("generic::getAll",(function(e,n){if(e)return Object(w.a)(e);console.debug("Loaded",n),t.value=n,S.value.length>0&&S.value.forEach((function(e,n){e=t.value.find((function(t){return t.id===e.id}))||e,S.value[n]=e})),T.value.loading=d.ButtonStates.success}))},M=function(){var t=Object(l.a)(regeneratorRuntime.mark((function t(n){var r,l,v,d,f,y,h,O,_,j,w,k=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=k.length>1&&void 0!==k[1]&&k[1],l=k.length>2?k[2]:void 0,v=0,d=Object.keys(e);case 3:if(!(v<d.length)){t.next=31;break}f=d[v],y=C(e[f]),t.prev=6,y.s();case 8:if((h=y.n()).done){t.next=20;break}if(O=h.value,!0!==(_=O(n[f]))){t.next=15;break}return t.abrupt("continue",18);case 15:return x.a.$emit("snack","red","[".concat(f,"] - ").concat(_)),E(),t.abrupt("return");case 18:t.next=8;break;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(6),y.e(t.t0);case 25:return t.prev=25,y.f(),t.finish(25);case 28:v++,t.next=3;break;case 31:for(j=0,w=[n].concat(Object(c.a)(r?S.value:[]));j<w.length;j++)w[j][l]=n[l];return t.next=34,Promise.all([n].concat(Object(c.a)(r?S.value:[])).map((function(e){return new Promise((function(t){console.log("Updating",{itemToUpdate:e},{attr:l,value:n[l]}),Object(m.getSocket)("/systems/polls").emit("polls::save",D(D({},e),{},Object(o.a)({},l,n[l])),(function(){t(!0)}))}))})));case 34:E(),x.a.$emit("snack","success","Data updated.");case 36:case"end":return t.stop()}}),t,null,[[6,22,25,28]])})));return function(e){return t.apply(this,arguments)}}(),R=function(){var e=Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.value=!1,e.next=3,Promise.all(S.value.map((function(e){return new Promise((function(t,n){e.id?Object(m.getSocket)("/systems/polls").emit("generic::deleteById",e.id,(function(e){e&&n(Object(w.a)(e)),t(!0)})):n(Object(w.a)("Missing item id"))}))})));case 3:E(),x.a.$emit("snack","success","Data removed."),S.value=[];case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(e){var t,n=(null!==(t=e.votes)&&void 0!==t?t:[]).reduce((function(a,b){return b.votes+a}),0);return"tips"===e.type?Number(n.toFixed(1)):n};return{addToSelectedItem:Object(j.a)(S,"id",V),saveCurrentItems:function(e){V.value=e},items:t,search:y,state:T,headers:B,headersDelete:[{value:"title",text:""},{value:"closedAt",text:""}],selected:S,selectable:A,deleteSelected:R,update:M,newDialog:I,deleteDialog:P,translate:h.a,saveSuccess:function(){E(),x.a.$emit("snack","success","Data updated."),I.value=!1},timestamp:$,rules:e,activeTime:function(e){return new Date(e.openedAt||Date.now()).getTime()},totalVotes:L,dayjs:f.dayjs,getPercentage:function(e,t,n){var r=0;if(e.votes)for(var i=0,o=e.votes.length;i<o;i++)e.votes[i].option===t&&(r+=e.votes[i].votes);return Number(100/L(e)*r||0).toFixed(n||0)},stop:function(e){e.isOpened=!1,e.closedAt=Date.now(),Object(m.getSocket)("/systems/polls").emit("polls::close",e,(function(e){e&&console.error(e)})),x.a.$emit("snack","success","Data updated.")},copy:function(e){console.log("Copying",e);var t=Object(O.cloneDeep)(e);t.id=Object(_.a)(),t.votes=[],t.isOpened=!0,t.openedAt=Date.now(),Object(m.getSocket)("/systems/polls").emit("polls::save",t,(function(){E()})),x.a.$emit("snack","success","Data copied.")},isRunning:n,ButtonStates:d.ButtonStates}}}),P=A,I=n(45),$=n(44),T=n.n($),B=n(48),E=n(43),M=n(27),R=n(268),L=n(379),F=n(30),N=n(358),U=n(134),J=n(140),component=Object(I.a)(P,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{class:{"pa-4":!e.$vuetify.breakpoint.mobile},attrs:{fluid:""}},[n("alert-disabled",{attrs:{system:"polls"}}),e._v(" "),n("v-data-table",{attrs:{"calculate-widths":"","show-select":e.selectable,search:e.search,loading:e.state.loading!==e.ButtonStates.success,headers:e.headers,"items-per-page":-1,items:e.items},on:{"current-items":e.saveCurrentItems,"click:row":e.addToSelectedItem},scopedSlots:e._u([{key:"top",fn:function(){return[n("v-sheet",{staticClass:"my-2 pb-2 mt-0",attrs:{flat:"",color:"dark"}},[n("v-row",{staticClass:"px-2",attrs:{"no-gutters":""}},[n("v-col",{staticClass:"pr-2",attrs:{cols:"auto","align-self":"center"}},[n("v-btn",{attrs:{icon:"",color:e.selectable?"primary":"secondary"},on:{click:function(t){e.selectable=!e.selectable}}},[n("v-icon",[e._v("\n                mdi-checkbox-multiple-marked-outline\n              ")])],1)],1),e._v(" "),n("v-col",{attrs:{"align-self":"center"}},[n("v-text-field",{staticClass:"pa-0 ma-2",attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),n("v-col",{attrs:{cols:"auto","align-self":"center"}},[e.selected.length>0?[n("v-dialog",{attrs:{"max-width":"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-btn",e._g(e._b({staticClass:"mr-1",attrs:{color:"error"}},"v-btn",o,!1),r),[e._v("\n                    Delete "+e._s(e.selected.length)+" Item(s)\n                  ")])]}}],null,!1,1852500087),model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[e._v(" "),n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[e._v("Delete "+e._s(e.selected.length)+" Item(s)?")])]),e._v(" "),n("v-card-text",[n("v-data-table",{attrs:{dense:"",items:e.selected,headers:e.headersDelete,"items-per-page":-1,"hide-default-header":"","hide-default-footer":""}})],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:""},on:{click:function(t){e.deleteDialog=!1}}},[e._v("\n                      Cancel\n                    ")]),e._v(" "),n("v-btn",{attrs:{color:"error",text:""},on:{click:e.deleteSelected}},[e._v("\n                      Delete\n                    ")])],1)],1)],1)]:e._e(),e._v(" "),n("v-dialog",{attrs:{"max-width":"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-btn",e._g(e._b({attrs:{color:"primary"}},"v-btn",o,!1),r),[e._v("\n                  New item\n                ")])]}}]),model:{value:e.newDialog,callback:function(t){e.newDialog=t},expression:"newDialog"}},[e._v(" "),n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[e._v("New item")])]),e._v(" "),n("v-card-text",{key:e.timestamp},[n("new-item",{attrs:{rules:e.rules},on:{close:function(t){e.newDialog=!1},save:e.saveSuccess}})],1)],1)],1)],2)],1)],1)]},proxy:!0},{key:"item.totalVotes",fn:function(t){var n=t.item;return[e._v("\n      "+e._s(e.totalVotes(n))+"\n    ")]}},{key:"item.votes",fn:function(t){var r=t.item;return[e._l(r.options,(function(option,t){return n("v-row",{key:r.id+option+t+"row",staticClass:"ma-0 pa-0 d-flex d-sm-none",attrs:{"no-gutters":""}},[n("v-col",{staticClass:"ma-1"},[e._v("\n          "+e._s(option)+"\n        ")]),e._v(" "),n("v-col",{staticClass:"text-right ma-1"},[e._v("\n          "+e._s(e.getPercentage(r,t,1))+"%\n        ")])],1)})),e._v(" "),e._l(r.options,(function(option,t){return n("v-progress-linear",{key:r.id+option+t,staticClass:"d-none d-sm-flex",attrs:{height:"20",value:e.getPercentage(r,t,1)},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.value;return[n("v-row",{staticClass:"ma-1"},[n("v-col",[e._v("\n              "+e._s(option)+"\n            ")]),e._v(" "),n("v-col",{staticClass:"text-right"},[e._v("\n              "+e._s(r)+"%\n            ")])],1)]}}],null,!0)})}))]}},{key:"item.type",fn:function(t){var n=t.item;return[e._v("\n      "+e._s(e.translate("systems.polls."+n.type))+"\n    ")]}},{key:"item.closedAt",fn:function(t){var r=t.item;return[r.isOpened?n("span",{staticClass:"green--text text--lighten-1"},[e._v(e._s(e.translate("systems.polls.activeFor"))+" "),n("strong",[e._v(e._s(e.dayjs().from(e.dayjs(e.activeTime(r)),!0)))])]):n("span",{staticClass:"red--text text--lighten-1"},[e._v(e._s(e.translate("systems.polls.closedAt"))+" "),n("strong",[e._v(e._s(e.dayjs(r.closedAt).format("LLL")))])])]}},{key:"item.buttons",fn:function(t){var r=t.item;return[r.isOpened?n("v-btn",{attrs:{icon:""},on:{click:function(t){return e.stop(r)}}},[n("v-icon",[e._v("mdi-stop")])],1):n("v-btn",{attrs:{disabled:e.isRunning,icon:""},on:{click:function(t){return e.copy(r)}}},[n("v-icon",[e._v("mdi-content-copy")])],1)]}}],null,!0),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)}),[],!1,null,null,null);t.default=component.exports;T()(component,{AlertDisabled:n(782).default}),T()(component,{VBtn:B.a,VCard:E.a,VCardActions:E.b,VCardText:E.d,VCardTitle:E.e,VCol:M.a,VContainer:M.b,VDataTable:R.a,VDialog:L.a,VIcon:F.a,VProgressLinear:N.a,VRow:M.d,VSheet:U.a,VSpacer:M.e,VTextField:J.a})},771:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonStates=void 0,t.ButtonStates={idle:0,progress:1,success:2,fail:3}},777:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(35);n(94),n(8),n(4),n(82),n(51),n(37),n(212),n(213),n(214),n(215),n(216),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(39);function o(e,t,n){var o=null,c="select";return function(l){var v=void 0===e.value?e:e.value,d=v.findIndex((function(e){return e[t]===l[t]})),f=!1;if(window.event&&(f=!!window.event.shiftKey),f){var m=n.value.findIndex((function(e){return e[t]===o})),y=n.value.findIndex((function(e){return e[t]===l[t]}));if("select"===c)for(var i=Math.min(m,y);i<=Math.max(m,y);i++)v.push(n.value[i]);else v=v.filter((function(e){for(var t=!0,r=Math.min(m,y);r<=Math.max(m,y);r++)if(e===n.value[r]){t=!1;break}return t}))}else o=l[t],-1===d?(v.push(l),c="select"):(v.splice(d,1),c="unselect");v=Array.from(new Set(Object(r.a)(v))),console.log(v)}}},782:function(e,t,n){"use strict";n.r(t);n(73),n(4),n(33);var r=n(5),o=n(49),c=n.n(o),l=n(1),v=Object(l.h)({props:{system:String,integration:String},setup:function(e){var t=Object(r.o)();return{isEnabled:Object(l.b)((function(){return e.system?t.state.$systems.find((function(t){return t.name===e.system})).enabled:!!e.integration&&t.state.$integrations.find((function(t){return t.name===e.integration})).enabled})),translate:c.a}}}),d=n(45),f=n(44),m=n.n(f),y=n(380),component=Object(d.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isEnabled?e._e():n("v-alert",{staticClass:"mb-0",attrs:{color:"error",text:""}},[e._v("\n  "+e._s(e.translate("this-system-is-disabled"))+"\n")])}),[],!1,null,null,null);t.default=component.exports;m()(component,{VAlert:y.a})}}]);