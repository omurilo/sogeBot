(window.webpackJsonp=window.webpackJsonp||[]).push([[172],{1463:function(e,t,n){"use strict";n.r(t);var r,o=n(1),c=n(60),l=(n(12),n(11),n(8),n(14),n(15),n(2)),v=n(147),d=n(26),m=(n(4),n(37),n(39),n(13),n(73),n(31),n(63),n(34),n(47),n(82),n(81),n(771)),f=n(118),_=n(21),y=n(49),h=n.n(y),x=n(148),O=n(173),j=n(777),w=n(80),k=n(141),S=n(783),D=n(265);function I(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function C(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?I(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):I(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var V={setup:function(e,t){var n=Object(c.d)().$graphql,l=Object(o.J)(!1),y=Object(o.J)([]),I=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.default.request(Object(x.a)(r||(r=Object(v.a)(["\n      query {\n        permissions { id name }\n      }\n    "]))));case 2:data=e.sent,y.value=data.permissions,l.value=!1;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V={variableName:[D.h,Object(D.j)(["$_"]),Object(D.e)(3),Object(D.i)([" "])]},P=Object(o.J)([]),T=Object(o.J)(null),J=Object(o.J)(""),N=Object(o.J)([]),E=Object(o.J)([]),$=Object(o.J)([]),A=Object(o.J)([]),R=Object(o.J)(!1),B=Object(o.J)(!1),L=Object(o.J)(!1),M=Object(o.b)({get:function(){return!!T.value},set:function(e){e||(T.value=null)}});Object(o.Y)(L,(function(e){e||(E.value=[])}));var H=Object(o.J)(Date.now());Object(o.Y)(B,(function(){H.value=Date.now()}));var Y=Object(o.J)({loading:m.ButtonStates.progress}),z=[{value:"variableName",text:"$_"},{value:"description",text:h()("registry.customvariables.description.name")},{value:"type",sortable:!0,text:h()("registry.customvariables.type.name")},{value:"additionalInfo",text:h()("registry.customvariables.additional-info"),sortable:!1},{value:"currentValue",text:h()("registry.customvariables.currentValue.name")},{value:"actions",text:"",sortable:!1},{text:"",value:"data-table-expand"}];Object(o.A)((function(){I(),F()}));var F=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([new Promise((function(e,t){Object(_.getSocket)("/core/customvariables").emit("customvariables::list",(function(n,r){if(n)return t(n),Object(w.a)(n);console.debug("Loaded",r),P.value=r,E.value.length>0&&E.value.forEach((function(e,t){e=P.value.find((function(t){return t.id===e.id}))||e,E.value[t]=e})),e()}))}))]);case 2:Y.value.loading=m.ButtonStates.success;case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.value=!1,e.next=3,Promise.all(E.value.map((function(e){return new Promise((function(t,n){void 0===e.id?n(Object(w.a)("Item ID is missing")):Object(_.getSocket)("/core/customvariables").emit("customvariables::delete",e.id,(function(e){e&&n(Object(w.a)(e)),t(!0)}))}))})));case 3:F(),k.a.$emit("snack","success","Data removed."),E.value=[];case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{ButtonStates:m.ButtonStates,dayjs:f.dayjs,translate:h.a,addToSelectedItem:j.a,getPermissionName:S.a,loading:l,permissions:y,rules:V,items:P,editItem:T,search:J,runningScripts:N,selected:E,expanded:$,currentItems:A,saveCurrentItems:function(e){A.value=e},deleteDialog:R,newDialog:B,selectable:L,editDialog:M,timestamp:H,state:Y,headers:z,headersDelete:[{value:"variableName",text:""},{value:"type",text:""}],headersHistory:[{value:"changedAt",text:""},{value:"value",text:""},{value:"username",text:""}],saveSuccess:function(){F(),k.a.$emit("snack","success","Data updated."),T.value=null,B.value=!1},deleteSelected:K,clone:function(e){Object(_.getSocket)("/core/customvariables").emit("customvariables::save",C(C({},e),{},{history:[],urls:[],id:Object(O.a)(),description:"(clone) of "+e.variableName,variableName:"$_".concat(Math.random().toString(36).substr(2,5))}),(function(e){e?console.error(e):k.a.$emit("snack","success","Data cloned."),F()}))},edit:function(e){T.value=e},runScript:function(e){N.value.includes(e)||(N.value.push(e),k.a.$emit("snack","success","Script triggered."),Object(_.getSocket)("/core/customvariables").emit("customvariables::runScript",e,(function(t){t?k.a.$emit("snack","error","Script error. "+t):F(),N.value.splice(N.value.indexOf(e),1)})))}}}},P=V,T=n(45),J=n(44),N=n.n(J),E=n(48),$=n(43),A=n(27),R=n(268),B=n(379),L=n(384),M=n(30),H=n(134),Y=n(140),component=Object(T.a)(P,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{class:{"pa-4":!e.$vuetify.breakpoint.mobile},attrs:{fluid:""}},[n("v-data-table",{attrs:{"single-expand":!0,"show-expand":"",expanded:e.expanded,"calculate-widths":"","show-select":e.selectable,search:e.search,loading:e.state.loading!==e.ButtonStates.success||e.loading,headers:e.headers,"items-per-page":-1,items:e.items,"sort-by":"name"},on:{"update:expanded":function(t){e.expanded=t},"current-items":e.saveCurrentItems,"click:row":function(t){return e.addToSelectedItem(e.selected,"id",e.currentItems)}},scopedSlots:e._u([{key:"top",fn:function(){return[n("v-sheet",{staticClass:"my-2 pb-2 mt-0",attrs:{flat:"",color:"dark"}},[n("v-row",{staticClass:"px-2",attrs:{"no-gutters":""}},[n("v-col",{staticClass:"pr-2",attrs:{cols:"auto","align-self":"center"}},[n("v-btn",{attrs:{icon:"",color:e.selectable?"primary":"secondary"},on:{click:function(t){e.selectable=!e.selectable}}},[n("v-icon",[e._v("\n                mdi-checkbox-multiple-marked-outline\n              ")])],1)],1),e._v(" "),n("v-col",{attrs:{"align-self":"center"}},[n("v-text-field",{staticClass:"pa-0 ma-2",attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),n("v-col",{attrs:{cols:"auto","align-self":"center"}},[e.selected.length>0?[n("v-dialog",{attrs:{"max-width":"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-btn",e._g(e._b({staticClass:"mr-1",attrs:{color:"error"}},"v-btn",o,!1),r),[e._v("\n                    Delete "+e._s(e.selected.length)+" Item(s)\n                  ")])]}}],null,!1,1852500087),model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[e._v(" "),n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[e._v("Delete "+e._s(e.selected.length)+" Item(s)?")])]),e._v(" "),n("v-card-text",[n("v-data-table",{attrs:{dense:"",items:e.selected,headers:e.headersDelete,"items-per-page":-1,"hide-default-header":"","hide-default-footer":""}})],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:""},on:{click:function(t){e.deleteDialog=!1}}},[e._v("\n                      Cancel\n                    ")]),e._v(" "),n("v-btn",{attrs:{color:"error",text:""},on:{click:e.deleteSelected}},[e._v("\n                      Delete\n                    ")])],1)],1)],1)]:e._e(),e._v(" "),n("v-dialog",{attrs:{fullscreen:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-btn",e._g(e._b({attrs:{color:"primary"}},"v-btn",o,!1),r),[e._v("\n                  New Item\n                ")])]}}]),model:{value:e.newDialog,callback:function(t){e.newDialog=t},expression:"newDialog"}},[e._v(" "),n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[e._v("New item")])]),e._v(" "),n("v-card-text",{key:e.timestamp},[n("new-item-customvariables-new-item",{attrs:{rules:e.rules},on:{close:function(t){e.newDialog=!1},save:e.saveSuccess}})],1)],1)],1),e._v(" "),n("v-dialog",{attrs:{fullscreen:""},model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}},[e.editItem?n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[e._v("Update item "),n("span",{staticClass:"primary--text pl-1"},[e._v(e._s(e.editItem.variableName))])])]),e._v(" "),n("v-card-text",{key:e.timestamp},[n("new-item-customvariables-new-item",{attrs:{item:e.editItem,rules:e.rules},on:{close:function(t){e.editItem=null},save:e.saveSuccess}})],1)],1):e._e()],1)],2)],1)],1)]},proxy:!0},{key:"expanded-item",fn:function(t){var r=t.headers,o=t.item;return[n("td",{staticClass:"pa-2",attrs:{colspan:r.length}},[n("h3",[e._v(e._s(e.translate("registry.customvariables.history")))]),e._v(" "),"eval"!==o.type.toLowerCase()?n("v-data-table",{attrs:{dense:"","hide-default-header":"",headers:e.headersHistory,"items-per-page":5,items:o.history,"sort-by":"changedAt","sort-desc":!0},scopedSlots:e._u([{key:"item.changedAt",fn:function(t){var n=t.item;return[e._v("\n            "+e._s(e.dayjs(n.changedAt).format("LL"))+" "+e._s(e.dayjs(n.changedAt).format("LTS"))+"\n          ")]}},{key:"item.username",fn:function(t){var r=t.item;return["n/a"!==r.username?n("NuxtLink",{attrs:{to:"/manage/viewers/"+r.quotedBy}},[e._v("\n              "+e._s(r.username)+"Â "),n("small",[e._v(e._s(r.userId))])]):n("span",[e._v("Dashboard")])]}}],null,!0)}):n("span",[e._v("Script doesn't have saved history")])],1)]}},{key:"item.description",fn:function(t){var r=t.item;return[0===r.description.length?n("span",{staticClass:"grey--text text--darken-3"},[e._v("No description set")]):e._e(),e._v("\n      "+e._s(r.description)+"\n    ")]}},{key:"item.type",fn:function(t){var n=t.item;return[e._v("\n      "+e._s(e.translate("registry.customvariables.types."+n.type))+"\n    ")]}},{key:"item.additionalInfo",fn:function(t){var r=t.item;return["eval"===r.type?n("span",[n("strong",[e._v(e._s(e.translate("registry.customvariables.run-script"))+":")]),e._v(" "),r.runEveryTypeValue>0?[e._v("\n          "+e._s(r.runEvery/r.runEveryTypeValue)+" "+e._s(e.translate("registry.customvariables.runEvery."+r.runEveryType))+"\n        ")]:[e._v("\n          "+e._s(e.translate("registry.customvariables.runEvery."+r.runEveryType))+"\n        ")],e._v(" "),n("div",[e._v("\n          "+e._s(e.translate("registry.customvariables.last-run"))+" "),n("strong",[e._v(e._s(r.runAt?new Date(r.runAt).toLocaleString():e.translate("commons.never")))])])],2):e._e(),e._v(" "),"options"===r.type?n("span",[n("strong",[e._v(e._s(e.translate("registry.customvariables.usableOptions.name"))+":")]),e._v("\n        "+e._s(r.usableOptions.join(", "))+"\n      ")]):e._e(),e._v(" "),r.readOnly?n("div",[n("strong",[e._v(e._s(e._f("capitalize")(e.translate("registry.customvariables.isReadOnly"))))])]):e._e(),e._v(" "),n("div",[n("strong",[e._v(e._s(e.translate("registry.customvariables.response.name"))+":")]),e._v(" "),0===r.responseType?n("span",[e._v(e._s(e.translate("registry.customvariables.response.default")))]):e._e(),e._v(" "),1===r.responseType?n("span",[e._v(e._s(e.translate("registry.customvariables.response.custom")))]):e._e(),e._v(" "),2===r.responseType?n("span",[e._v(e._s(e.translate("registry.customvariables.response.command")))]):e._e(),e._v(" "),1===r.responseType?n("i",[e._v(e._s(r.responseText))]):e._e()]),e._v(" "),n("div",[n("strong",[e._v(" "+e._s(e.translate("registry.customvariables.permissionToChange"))+":")]),e._v(" "),e.getPermissionName(r.permission,e.permissions)?n("span",[e._v(e._s(e.getPermissionName(r.permission,e.permissions)))]):n("span",{staticClass:"red--text  text--lighten-1"},[n("v-icon",[e._v("mdi-exclamation-thick")]),e._v("  Permission not found")],1)])]}},{key:"item.actions",fn:function(t){var r=t.item;return[n("div",{staticStyle:{width:"max-content"}},[n("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var o=t.hover;return[n("v-btn",{attrs:{icon:"",color:o?"primary":"secondary lighten-3"},on:{click:function(t){return t.stopPropagation(),e.edit(r)}}},[n("v-icon",[e._v("mdi-pencil")])],1)]}}],null,!0)}),e._v(" "),n("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var o=t.hover;return[n("v-btn",{attrs:{icon:"",color:o?"primary":"secondary lighten-3"},on:{click:function(t){return t.stopPropagation(),e.clone(r)}}},[n("v-icon",[e._v("mdi-content-copy")])],1)]}}],null,!0)}),e._v(" "),"eval"===r.type?n("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var o=t.hover;return[n("v-btn",{attrs:{icon:"",color:o?"primary":"secondary lighten-3"},on:{click:function(t){return e.runScript(r.id)}}},[n("v-icon",{class:{spin:e.runningScripts.includes(r.id)}},[e._v("\n              "+e._s(e.runningScripts.includes(r.id)?"mdi-cog":"mdi-cog-refresh")+"\n            ")])],1)]}}],null,!0)}):e._e()],1)]}}],null,!0),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)}),[],!1,null,null,null);t.default=component.exports;N()(component,{NewItemCustomvariablesNewItem:n(1411).default}),N()(component,{VBtn:E.a,VCard:$.a,VCardActions:$.b,VCardText:$.d,VCardTitle:$.e,VCol:A.a,VContainer:A.b,VDataTable:R.a,VDialog:B.a,VHover:L.a,VIcon:M.a,VRow:A.d,VSheet:H.a,VSpacer:A.e,VTextField:Y.a})},777:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(35);n(94),n(8),n(4),n(82),n(51),n(37),n(212),n(213),n(214),n(215),n(216),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(39);function o(e,t,n){var o=null,c="select";return function(l){var v=void 0===e.value?e:e.value,d=v.findIndex((function(e){return e[t]===l[t]})),m=!1;if(window.event&&(m=!!window.event.shiftKey),m){var f=n.value.findIndex((function(e){return e[t]===o})),_=n.value.findIndex((function(e){return e[t]===l[t]}));if("select"===c)for(var i=Math.min(f,_);i<=Math.max(f,_);i++)v.push(n.value[i]);else v=v.filter((function(e){for(var t=!0,r=Math.min(f,_);r<=Math.max(f,_);r++)if(e===n.value[r]){t=!1;break}return t}))}else o=l[t],-1===d?(v.push(l),c="select"):(v.splice(d,1),c="unselect");v=Array.from(new Set(Object(r.a)(v))),console.log(v)}}},783:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(73),n(4),n(71),n(33);var r=function(e,t){if(!t)throw new Error("Missing permissions list");if(!e)return"-- unset --";var n=t.find((function(t){return t.id===e}));return void 0!==n?""===n.name.trim()?n.id:n.name:null}}}]);