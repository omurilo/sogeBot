(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{1411:function(e,t,r){"use strict";r.r(t);r(1),r(40),r(51),r(37),r(55),r(39);var n,l=r(26),o=r(147),c=r(35),v=(r(81),r(28),r(31),r(33),r(11),r(52),r(4),r(73),r(24),r(1253),r(34),r(47),r(71),r(82),r(25),r(8),r(5)),m=r(771),d=r(386),f=r(21),y=r(49),h=r.n(y),x=r(148),_=r(173),O=r(80),V=r(141),S=r(827),k=r(265);function j(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,l=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw l}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var E=Object(v.c)({components:{PrismEditor:S.a},props:{rules:Object,item:Object},setup:function(e,t){var r,y=Object(v.k)(),T=Object(v.i)([]),E={runEveryX:[k.h,Object(k.f)(0)],variableName:[].concat(Object(c.a)(e.rules.variableName),[function(){return Y.value.isUnique===m.ButtonStates.progress||Y.value.isUnique===m.ButtonStates.success||h()("registry.customvariables.variable.error.isNotUnique")}])},w=Object(v.a)((function(){if(B.value){var e,t=j(E.variableName);try{for(t.s();!(e=t.n()).done;){var r=(0,e.value)(U.value);if("string"==typeof r)return r}}catch(e){t.e(e)}finally{t.f()}}return!0})),N=Object(v.i)(1),R=Object(v.i)(!1),C=Object(v.a)((function(){return T.value.map((function(e){return{text:e.name,value:e.id,disabled:!1}}))})),I=Object(v.i)(e.item?e.item.id:Object(_.a)()),U=Object(v.i)(e.item?e.item.variableName:""),B=Object(v.i)(!1),P=Object(v.i)(e.item?e.item.urls:[]),A=Object(v.i)(e.item?e.item.history:[]),D=Object(v.i)(e.item?e.item.currentValue:""),$=Object(v.i)(e.item?e.item.permission:d.defaultPermissions.MODERATORS),G=Object(v.i)(!!e.item&&e.item.readOnly),L=Object(v.i)(e.item?e.item.usableOptions:[]),X=Object(v.i)(e.item?e.item.runAt:Date.now()),F=Object(v.i)(e.item?e.item.type:"text"),H=Object(v.i)(e.item?e.item.description:""),J=Object(v.i)(e.item?e.item.responseType:0),z=Object(v.i)(e.item?e.item.responseText:""),M=Object(v.i)(e.item?e.item.evalValue:""),K=Object(v.i)(e.item?e.item.runEveryType:"isUsed"),Q=Object(v.i)(e.item?(null!==(r=e.item.runEvery)&&void 0!==r?r:0)/(e.item.runEvery||1):0),W=Object(v.i)(""),Y=Object(v.i)({test:m.ButtonStates.idle,isUnique:m.ButtonStates.success}),Z=Object(v.i)(null),ee=Object(v.i)(!0);Object(v.p)(U,(function(e){var t;Y.value.isUnique=m.ButtonStates.progress,Object(f.getSocket)("/core/customvariables").emit("customvariables::isUnique",{variable:e,id:null!==(t=I.value)&&void 0!==t?t:""},(function(e,t){e?V.a.$emit("snack","error",e):Y.value.isUnique=t?m.ButtonStates.success:m.ButtonStates.fail}))}));var te=[{value:"number",text:h()("registry.customvariables.types.number")},{value:"text",text:h()("registry.customvariables.types.text")},{value:"options",text:h()("registry.customvariables.types.options")},{value:"eval",text:h()("registry.customvariables.types.eval")}],re=Object(v.a)((function(){return L.value.map((function(e){return{value:e,text:e}}))})),ae=[{seconds:0,text:h()("registry.customvariables.runEvery.isUsed"),value:"isUsed"},{seconds:1e3,text:h()("registry.customvariables.runEvery.seconds"),value:"seconds"},{seconds:6e4,text:h()("registry.customvariables.runEvery.minutes"),value:"minutes"},{seconds:36e5,text:h()("registry.customvariables.runEvery.hours"),value:"hours"},{seconds:864e5,text:h()("registry.customvariables.runEvery.days"),value:"days"}];Object(v.f)((function(){y.$graphql.default.request(Object(x.a)(n||(n=Object(o.a)(["\n        query {\n          permissions { id name }\n        }\n      "])))).then((function(data){T.value=data.permissions})),e.item||fetch("/assets/custom-variables-code.txt").then((function(e){return e.text()})).then((function(data){return M.value=data})).catch((function(e){Object(O.a)(e)}))}));var ne=function(){var e=Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B.value=!0,!0!==w.value||!Z.value.validate()){e.next=5;break}return R.value=!0,e.next=5,new Promise((function(){var e,r,n,l,o,c={id:I.value,variableName:U.value,history:A.value,currentValue:D.value,urls:P.value,permission:$.value,readOnly:G.value,usableOptions:L.value,runAt:X.value,type:F.value,description:H.value,responseType:J.value,responseText:z.value,evalValue:M.value,runEveryType:K.value,runEveryTypeValue:null!==(e=null===(r=ae.find((function(e){return e.value===K.value})))||void 0===r?void 0:r.seconds)&&void 0!==e?e:0,runEvery:(o=null!==(n=null===(l=ae.find((function(e){return e.value===K.value})))||void 0===l?void 0:l.seconds)&&void 0!==n?n:0,Number(Q.value*o))};console.log("Saving",{item:c}),Object(f.getSocket)("/core/customvariables").emit("customvariables::save",c,(function(){t.emit("save"),R.value=!1}))}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(v.p)([F,D],(function(){"number"===F.value&&(Number.isFinite(Number(D.value))||(D.value="0")),"options"===F.value&&L.value.length>0&&!L.value.includes(D.value)&&(D.value=L.value[0])}));var ie=[{value:"GET",text:"GET"},{value:"POST",text:"POST"},{value:"showResponse",text:h()("registry.customvariables.response.show")},{value:"link",text:""},{value:"actions",text:""}];return{variableName:U,evalValue:M,type:F,currentValue:D,newItem:ne,optionSearch:W,runEveryX:Q,runEveryType:K,e1:N,translate:h.a,newItemSaving:R,form2:Z,valid2:ee,closeDlg:function(){t.emit("close")},validateForm:function(){1===N.value&&(B.value=!0),2===N.value&&Z.value.validate(),N.value++},permission:$,urls:P,generateURL:function(){var e;null===(e=P.value)||void 0===e||e.push({id:Object(_.a)(),showResponse:!1,GET:!1,POST:!1})},removeURL:function(e){var t;P.value=null===(t=P.value)||void 0===t?void 0:t.filter((function(t){return t.id!==e}))},description:H,responseType:J,responseText:z,availableTypes:te,availableValues:re,availableRunEvery:ae,setCurrentValueOption:function(e){0!==e.trim().length&&(D.value=e,L.value.includes(e)||L.value.push(e))},removeOption:function(e){L.value.splice(L.value.indexOf(e.text),1)},ButtonStates:m.ButtonStates,states:Y,testScript:function(){Y.value.test=m.ButtonStates.progress,Object(f.getSocket)("/core/customvariables").emit("customvariables::testScript",{evalValue:M.value,currentValue:D.value},(function(e,t){Y.value.test=m.ButtonStates.idle,e?V.a.$emit("snack","error",e):D.value=t}))},computedRules:E,isVariableNameValid:w,variableNameDirty:B,permissions:T,permissionItems:C,urlsHeaders:ie,origin:"/",highlighterJS:S.d}}}),w=E,N=r(45),R=r(44),C=r.n(R),I=r(48),U=r(361),B=r(27),P=r(778),A=r(268),D=r(362),$=r(377),G=r(384),L=r(30),X=r(18),F=r(143),H=r(1169),J=r(266),z=r(134),M=r(267),K=r(794),Q=r(140),component=Object(N.a)(w,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-stepper",{key:e.item?e.item.id:"create",model:{value:e.e1,callback:function(t){e.e1=t},expression:"e1"}},[r("v-stepper-header",[r("v-stepper-step",{attrs:{complete:e.e1>1,step:"1",editable:"",rules:[function(){return"string"!=typeof e.isVariableNameValid}]}},[e._v("\n      Name your custom variable\n    ")]),e._v(" "),r("v-divider"),e._v(" "),r("v-stepper-step",{attrs:{complete:e.e1>2,step:"2",editable:"",rules:[function(){return e.valid2}]}},[e._v("\n      Set type and value\n    ")]),e._v(" "),r("v-divider"),e._v(" "),r("v-stepper-step",{attrs:{complete:e.e1>3,step:"3",editable:""}},[e._v("\n      REST access\n      "),r("small",[e._v("Optional")])]),e._v(" "),r("v-divider"),e._v(" "),r("v-stepper-step",{attrs:{complete:e.e1>4,step:"4",editable:""}},[e._v("\n      Settings\n      "),r("small",[e._v("Optional")])])],1),r("v-stepper-items",[r("v-stepper-content",{attrs:{step:1}},[r("v-text-field",{attrs:{label:e.translate("registry.customvariables.variable.name"),hint:e.translate("registry.customvariables.variable.help"),error:"string"==typeof e.isVariableNameValid,"error-messages":"string"==typeof e.isVariableNameValid?[e.isVariableNameValid]:[],"hide-details":"auto",required:"",counter:""},on:{input:function(t){e.variableNameDirty=!0}},scopedSlots:e._u([{key:"append",fn:function(){return[e.states.isUnique===e.ButtonStates.progress?r("v-progress-circular",{attrs:{size:"18",indeterminate:""}}):e._e()]},proxy:!0}]),model:{value:e.variableName,callback:function(t){e.variableName=t},expression:"variableName"}}),e._v(" "),r("v-text-field",{attrs:{label:e.translate("registry.customvariables.description.name"),hint:e.translate("registry.customvariables.description.help"),counter:""},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1),e._v(" "),r("v-stepper-content",{attrs:{step:2}},[r("v-form",{ref:"form2",attrs:{"lazy-validation":""},model:{value:e.valid2,callback:function(t){e.valid2=t},expression:"valid2"}},[r("v-select",{attrs:{items:e.availableTypes,label:e.translate("registry.customvariables.type.name")},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}}),e._v(" "),"text"===e.type||"number"===e.type?r("v-text-field",{attrs:{label:e.translate("registry.customvariables.currentValue.name")},model:{value:e.currentValue,callback:function(t){e.currentValue=t},expression:"currentValue"}}):e._e(),e._v(" "),"options"===e.type?r("v-combobox",{attrs:{dense:"",value:e.currentValue,"return-object":!1,items:e.availableValues,"search-input":e.optionSearch,label:e.translate("registry.customvariables.currentValue.name")},on:{"update:searchInput":function(t){e.optionSearch=t},"update:search-input":function(t){e.optionSearch=t},change:function(t){return e.setCurrentValueOption(t)}},scopedSlots:e._u([{key:"item",fn:function(t){var n=t.item;return[r("v-chip",{attrs:{color:n.color+" lighten-3",dark:"",label:"",small:""}},[e._v("\n              "+e._s(n.text)+"\n            ")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-list-item-action",{staticClass:"ma-0",on:{click:function(e){e.stopPropagation()}}},[r("v-btn",{attrs:{icon:"",color:"error"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.removeOption(n)}}},[r("v-icon",[e._v("mdi-delete-forever")])],1)],1)]}},{key:"no-data",fn:function(){return[r("v-list-item",[r("v-list-item-content",[r("v-list-item-title",[e._v('\n                  No results matching "'),r("strong",[e._v(e._s(e.optionSearch))]),e._v('". Press '),r("kbd",[e._v("enter")]),e._v(" to create a new one\n                ")])],1)],1)]},proxy:!0}],null,!1,3550318144)}):e._e(),e._v(" "),"eval"===e.type?[r("prism-editor",{attrs:{"line-numbers":"","tab-size":4,highlight:e.highlighterJS},model:{value:e.evalValue,callback:function(t){e.evalValue=t},expression:"evalValue"}}),e._v(" "),r("v-text-field",{attrs:{readonly:"",label:e.translate("registry.customvariables.currentValue.name")},scopedSlots:e._u([{key:"append-outer",fn:function(){return[r("v-btn",{attrs:{loading:e.states.test!==e.ButtonStates.idle},on:{click:e.testScript}},[e._v("\n                "+e._s(e.translate("registry.customvariables.testCurrentScript.name"))+"\n              ")])]},proxy:!0}],null,!1,4272948512),model:{value:e.currentValue,callback:function(t){e.currentValue=t},expression:"currentValue"}}),e._v(" "),r("v-select",{attrs:{items:e.availableRunEvery,label:e.translate("registry.customvariables.runScript.name")},scopedSlots:e._u([{key:"append-outer",fn:function(){return["isUsed"!==e.runEveryType?r("v-text-field",{staticClass:"pa-0 ma-0",staticStyle:{position:"relative",top:"-4px"},attrs:{rules:e.computedRules.runEveryX,label:"Value",type:"number",min:"0"},model:{value:e.runEveryX,callback:function(t){e.runEveryX=t},expression:"runEveryX"}}):e._e()]},proxy:!0}],null,!1,1574716232),model:{value:e.runEveryType,callback:function(t){e.runEveryType=t},expression:"runEveryType"}})]:e._e()],2)],1),e._v(" "),r("v-stepper-content",{attrs:{step:"3"}},[r("v-data-table",{attrs:{dense:"",items:e.urls,headers:e.urlsHeaders,"items-per-page":-1},scopedSlots:e._u([{key:"top",fn:function(){return[r("v-sheet",{attrs:{flat:"",color:"dark"}},[r("v-row",{attrs:{"no-gutters":""}},[r("v-col",{attrs:{cols:"auto","align-self":"center"}},[r("v-btn",{on:{click:e.generateURL}},[e._v("\n                  "+e._s(e.translate("registry.customvariables.generateurl"))+"\n                ")])],1)],1)],1)]},proxy:!0},{key:"item.GET",fn:function(t){var n=t.item;return[r("v-simple-checkbox",{model:{value:n.GET,callback:function(t){e.$set(n,"GET",t)},expression:"item.GET"}})]}},{key:"item.POST",fn:function(t){var n=t.item;return[r("v-simple-checkbox",{model:{value:n.POST,callback:function(t){e.$set(n,"POST",t)},expression:"item.POST"}})]}},{key:"item.showResponse",fn:function(t){var n=t.item;return[r("v-simple-checkbox",{model:{value:n.showResponse,callback:function(t){e.$set(n,"showResponse",t)},expression:"item.showResponse"}})]}},{key:"item.link",fn:function(t){var r=t.item;return[e._v("\n          "+e._s(e.origin)+"/customvariables/"+e._s(r.id)+"\n        ")]}},{key:"item.actions",fn:function(t){var n=t.item;return[r("div",{staticStyle:{width:"max-content"}},[r("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var l=t.hover;return[r("v-btn",{attrs:{icon:"",color:l?"primary":"secondary lighten-3",href:"/customvariables/"+n.id}},[r("v-icon",[e._v("mdi-link")])],1)]}}],null,!0)}),e._v(" "),r("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var l=t.hover;return[r("v-btn",{attrs:{icon:"",color:l?"red":"secondary lighten-3"},on:{click:function(t){return e.removeURL(n.id)}}},[r("v-icon",[e._v("mdi-delete-forever")])],1)]}}],null,!0)})],1)]}}],null,!0)})],1),e._v(" "),r("v-stepper-content",{attrs:{step:"4"}},[r("v-select",{staticClass:"ma-2",attrs:{label:e.translate("permission"),items:e.permissionItems},model:{value:e.permission,callback:function(t){e.permission=t},expression:"permission"}}),e._v(" "),r("v-container",{class:{"pa-4":!e.$vuetify.breakpoint.mobile},attrs:{fluid:""}},[r("h5",{staticStyle:{"font-weight":"normal"}},[e._v("\n          "+e._s(e.translate("registry.customvariables.response.name"))+"\n        ")]),e._v(" "),r("v-radio-group",{model:{value:e.responseType,callback:function(t){e.responseType=t},expression:"responseType"}},[r("v-radio",{key:"responseType-0",attrs:{label:e.translate("registry.customvariables.response.default"),value:0}}),e._v(" "),r("v-radio",{key:"responseType-1",attrs:{label:e.translate("registry.customvariables.response.custom"),value:1},on:{click:function(t){e.responseText=""}}}),e._v(" "),r("v-radio",{key:"responseType-2",attrs:{label:e.translate("registry.customvariables.response.command")+" - "+e.translate("registry.customvariables.useIfInCommand"),value:2},on:{click:function(t){e.responseText=""}}})],1),e._v(" "),1===e.responseType?r("v-text-field",{attrs:{label:e.translate("registry.customvariables.response.default-placeholder"),counter:""},model:{value:e.responseText,callback:function(t){e.responseText=t},expression:"responseText"}}):e._e()],1)],1),e._v(" "),r("v-sheet",[r("v-btn",{staticClass:"ma-2",attrs:{plain:""},on:{click:e.closeDlg}},[e._v("\n        close\n      ")]),e._v(" "),e.e1<4?r("v-btn",{staticClass:"ma-2",attrs:{plain:""},on:{click:e.validateForm}},[e._v("\n        next step\n      ")]):e._e(),e._v(" "),r("v-btn",{staticClass:"ma-2",attrs:{color:"primary",disabled:!(!0===e.isVariableNameValid&&!0===e.valid2)},on:{click:e.newItem}},[e._v("\n        yes, "+e._s(e.item?"update":"create")+"\n      ")])],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports;C()(component,{VBtn:I.a,VChip:U.a,VCol:B.a,VCombobox:P.a,VContainer:B.b,VDataTable:A.a,VDivider:D.a,VForm:$.a,VHover:G.a,VIcon:L.a,VListItem:X.c,VListItemAction:X.d,VListItemContent:X.f,VListItemTitle:X.j,VProgressCircular:F.a,VRadio:H.a,VRadioGroup:H.b,VRow:B.d,VSelect:J.a,VSheet:z.a,VSimpleCheckbox:M.b,VSpacer:B.e,VStepper:K.a,VStepperContent:K.b,VStepperHeader:K.c,VStepperItems:K.d,VStepperStep:K.e,VTextField:Q.a})},827:function(e,t,r){"use strict";r.d(t,"d",(function(){return o})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return c}));var n=r(983),l=r(821);r.d(t,"a",(function(){return l.a}));r(984),r(985),r(986),r(987);var o=function(code){return Object(n.highlight)(code,n.languages.js,"javascript")},c=function(code){return Object(n.highlight)(code,n.languages.html,"html")},v=function(code){return Object(n.highlight)(code,n.languages.css,"css")}}}]);